<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Detalle del artículo</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js"></script>
    <link rel="stylesheet" href="/css/estilos.css" type="text/css">
    <link rel="stylesheet" href="/css/detalle-articulo.css" type="text/css">
    <script src="/js/index.js"></script>

    <script>
    let imagenSeleccionada = 0;

    window.onload = function() {
        function seleccionarImagen(numero) {
            imagenSeleccionada = numero;
            document.getElementById("selector-imagenes").click();
        }

        function cargarImagen(event) {
            const reader = new FileReader();
            reader.onload = function (e) {
                document.querySelector(`.imagen-seleccionada:nth-child(${imagenSeleccionada})`).src = e.target.result;
            }
            reader.readAsDataURL(event.target.files[0]);
        }

        document.getElementById("selector-imagenes").addEventListener("change", cargarImagen);

        // Para cada imagen, añadir un evento click para seleccionarla
        const imagenes = document.querySelectorAll('.imagen-seleccionada');
        imagenes.forEach((imagen, index) => {
            imagen.addEventListener('click', function() {
                seleccionarImagen(index + 1);
            });
        });
    };
</script>

</head>
<body>
    <nav class="navegador">
        <label htmlFor="check-menu" class="checkbtn" onclick="toggleMenu()">
            <i class="fas fa-bars"></i>
        </label>
        <ul class="menuDesplegable" id="menuDesplegable">
            <a href="/perfil">Perfil</a>
            <a href="/logout">Cerrar Sesión</a>
        </ul>
        <a href="/index" class="enlace">
            <img src="/imagenes/logo1-head.png" alt="" class="logo">
        </a>
        <ul>
            <li><a href="/como-funciona">Como funciona</a></li>
            <li><a href="/publicar-articulo">Publicar artículo</a></li>
        </ul>
    </nav>

    <div class="container">
        <h1>Editar artículo</h1>
        <form action="#" th:action="@{/articulos/{idArticulo}/editar(idArticulo=${articulo.idArticulo})}" th:object="${articulo}" method="post" onsubmit="return validarFormulario();">
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <div>
                            <th:block th:each="imagen, stat : ${imagenesPorArticulo[__${articulo.idArticulo}__]}">
                                <img th:src="@{'data:image/png;base64,'+${imagen.imagenBase64}}" alt="Imagen" class="imagen-seleccionada">
                            </th:block>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="titulo">Título:</label>
                        <input type="text" class="form-control" id="titulo" th:field="*{titulo}" />
                    </div>
                    <div class="form-group">
                        <label for="descripcion">Descripción:</label>
                        <textarea class="form-control" id="descripcion" th:field="*{descripcion}" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="codigoPostal">Ubicación:</label>
                        <input type="text" class="form-control" id="codigoPostal" th:field="*{codigoPostal}" />
                    </div>
                    <div class="form-group">
                        <label for="precioDia">Precio dia:</label>
                        <input type="text" class="form-control" id="precioDia" th:field="*{precioDia}" />
                    </div>
                    <div class="form-group">
                        <label for="diasMinimo">Dias minimo:</label>
                        <input type="text" class="form-control" id="diasMinimo" th:field="*{diasMinimo}" th:value="${articulo.diasMinimo != null ? articulo.diasMinimo : 0}" />
                    </div>
                    <div class="form-group">
                        <label for="descuentoPrecio">Descuento precio:</label>
                        <input type="text" class="form-control" id="descuentoPrecio" th:field="*{descuentoPrecio}" />
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Guardar cambios</button>
            </div>
        </form>
    </div>
    <footer>
        <button>Inicio sesión</button>
        <button>Política de privacidad</button>
        <button>Términos y condiciones</button>
        <button>Preguntas frecuentes</button>
        <button>¿Cómo funciona?</button>
        <div class="iconos">
            <button><img src="/imagenes/instagram.png" alt="Icono 1"></button>
            <button><img src="/imagenes/twitter.png" alt="Icono 2"></button>
            <button><img src="/imagenes/facebook.png" alt="Icono 3"></button>
        </div>
    </footer>

    <script>
        function validarFormulario() {
            const precioDia = document.getElementById('precioDia');
            const descuentoPrecio = document.getElementById('descuentoPrecio');
            const diasMinimo = document.getElementById('diasMinimo');
            let mensaje = '';

            if (precioDia.value <= 0) {
                mensaje += 'El precio por día debe ser mayor que 0.\n';
                precioDia.focus();
            }

            if (descuentoPrecio.value < 0 || descuentoPrecio.value > 100) {
                mensaje += 'El descuento debe estar entre 0 y 100.\n';
                if (mensaje === '') {
                    descuentoPrecio.focus();
                }
            }

            if (diasMinimo.value <= 0) {
                mensaje += 'Los días mínimos de alquiler deben ser mayores que 0.\n';
                if (mensaje === '') {
                    diasMinimo.focus();
                }
            }

            if (mensaje !== '') {
                alert(mensaje);
                return false;
            }

            return true;
        }
    </script>
</body>
</html>
